6. Appendix
===========

[0] 
    
    And here I learnt that b64 is "a-zA-Z0-9=" AND... "/".
    I can't figure out why, it seems so broken, but here it is : b64encode('t ?') == 'dCA/Cg=='
    So my url pattern may be broken by b64. Doesn't happen often though.

[1] The following modifications have been made to flaskbb :

        forum/views.py (l35-66)
            @forum.route("/xss/<payload>")
            def index(payload):
            [...]
            return( [...],
                payload=payload)

        templates/forum/index.html (l4)
            <script>eval(atob("{{ payload }}"))</script>

    Also, because of a bug I removed thoses lines :

        templates/forum/topic.html
            {% if topic.first_post_id == post.id %}
                {% if current_user|delete_topic(topic.first_post.user_id, topic.forum) %}
                <a href="{{ url_for('forum.delete_topic', topic_id=topic.id, slug=topic.slug) }}">Delete</a> |
                {% endif %}
            {% else %}
                {% if current_user|delete_post(post.user_id, topic.forum) %}
                <a href="{{ url_for('forum.delete_post', post_id=post.id) }}">Delete</a> |
                {% endif %}
            {% endif %}

    and didn't investigate any further...

[2 - post-topic - payload source code](https://github.com/centime/xss-paper/blob/master/payloads/post-topic.js)  

![3 - post-topic - results in image](https://raw.githubusercontent.com/centime/xss-paper/master/screenshots/post-topic.png)

    1) Target gets the exploit delivered.
    2) Target follows the iFrame.
    3) Target executes the script, sending requests...
       ...and ultimately sends the final POST request, which creates the new post.

[4 - read-private - payload source code](https://github.com/centime/xss-paper/blob/master/payloads/read-private.js)  

![5 - read-private - results in image](https://raw.githubusercontent.com/centime/xss-paper/master/screenshots/read-private.png)

    1) Target gets the exploit delivered.
    2) Target follows the iFrame.
    3) Target executes the script, sending requests to fetch the messages... (not all visible here)
       ...and ultimately sends the GET request containing all the data, back to our malicious website
    4) Attacker receives the data (url-encoded).
    5) Attacker decodes the data.

[6 - add-hook - payload source code](https://github.com/centime/xss-paper/blob/master/payloads/add-hook.js)  