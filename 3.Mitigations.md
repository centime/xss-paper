IV. Mitigations
===============

HTTP revisions
--------------

    HttpOnly
        "If the HttpOnly flag (optional) is included in the HTTP response header, the cookie cannot be accessed through client side script (again if the browser supports this flag)"

    Same-origin policy (SOP)
        "prevents access to DOM on different sites. Applies to XMLHttpRequests unless the server provides an Access-Control-Allow-Origin (CORS) header. Notably, WebSockets are not subject to the same-origin policy."

    Cross-origin resource sharing (CORS)
        "CORS defines a way in which the browser and the server can interact to determine whether or not to allow the cross-origin request"
    
        "CORS is actually implemented in the server. When "enabled", it simply sends an HTTP header (Access Control Allow Origin) with the response. The browser implements the SOP. If it doesn't see the right headers, it blocks the response."

    Content Security Policy (CSP)
        "standard HTTP header that allows website owners to declare approved sources of content that browsers should be allowed to load on that page"
        "Candidate Recommendation of the W3C"
        "Initial support for CSP in some web frameworks such as AngularJS and Django. Instructions for Ruby on Rails have been posted by GitHub."
        Webkit, Gecko2 are compliant to different experimental versions of headers
        Bypass :
            the permissive rules of the <script> tag allow to craft seemingly inoffensive but malicious files, that will serve as payload if uploaded on the targeted domain[0TODO].

    HTTP Header Field X-Frame-Options (Not a revision actually)
        Forbids the page to be rendered in a frame (iframe)

Source : Wikipedia.

TODO : concl ? examples ? what does this shit mean ?

Developer
---------

    Sanitize inputs :
        Rule #1 : HTML Escape Before Inserting Untrusted Data into HTML Element Content
            String safe = ESAPI.encoder().encodeForHTML( request.getParameter( "input" ) );
        Rule #2 : Attribute Escape Before Inserting Untrusted Data into HTML Common Attributes
            String safe = ESAPI.encoder().encodeForHTMLAttribute( request.getParameter( "input" ) );
        Rule #3 : JavaScript Escape Before Inserting Untrusted Data into JavaScript Data Values
            String safe = ESAPI.encoder().encodeForJavaScript( request.getParameter( "input" ) );
        And so on, until Rule #7... 
            See OWASP[1]
        And this is just for Stored or Reflected XSS attacks
            5 more rules against DOM-based (and not one line like thoses, but ~5l each !) [2TODO1]
        
    ... What could possibly go wrong ?

    Frameworks :
        Most of them take care of all of theses input sanitization.
        But they are not perfect...
            See Mustache project[2TODO]
        How do we keep js librairies up to date ?
            "We don't" Stack Overflow[2TODO2]
            "our current policy is to never update them once a stable release of Drupal core comes out"[2TODO3]
            Because js libs often break backward compatibility... even Google's cdn serves libs by version.[2TODO4]

    Alternatives to javascript ?
        We know JS is bad, but at least the work-arounds are known and well-documented...

Server admin
------------

    Web Application Firewall (WAF)
        "An application firewall is a form of firewall which controls input, output, and/or access from, to, or by an application or service."
        Won't replace a proper sanitizing !

    reverse proxy (cf paper)
    monitoring (cf paper)

Browser
-------

    cf HTTP revisions : HttpOnly / SOP / CORS / CSP

    XSS-filters
        WebKit XSSAuditor[2]
        IE since IE8 [3]
        Firefox : feature status=In progress[5]
        Noscript[6]

        Security done wrong.
            Using heuristics, but the browser cannot reliably discriminate between legitimate and malicious scripts.
            Blocks only trivial cases, easily bypassed.
            False feeling of security.
            Can even backfire : IE8 UXSS fail [4]

Refs
----

    [0] https://code.google.com/p/mustache-security/w/list  
    [0TODO] http://iamajin.blogspot.in/2014/11/when-gifs-serve-javascript.html
    [1] https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet  
    [2TODO1] https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet
    [2TODO] https://code.google.com/p/mustache-security/w/list
    [2TODO2] http://stackoverflow.com/questions/5904217/how-do-you-keep-your-javascript-libraries-updated-to-the-latest-versions-in-a-la
    [2TODO3] https://www.drupal.org/node/1787222
    [2TODO4] https://developers.google.com/speed/libraries/devguide
    [2] http://blog.chromium.org/2010/01/security-in-depth-new-security-features.html  
    [3] http://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-iv-the-xss-filter.aspx  
    [4] http://p42.us/ie8xss/Abusing_IE8s_XSS_Filters.pdf  
    [5] https://wiki.mozilla.org/Security/Features/XSS_Filter  
    [6] https://noscript.net/  